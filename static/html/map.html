<!DOCTYPE html>
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>基础地图展示</title>

  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta tabindex="">
  <link rel="stylesheet" type="text/css" href="http://117.184.195.173:25002/jsmap/1.0/demo/apidemos/sourceLinks/style.css">
  <script type="text/javascript" src="http://117.184.195.173:25002/jsmap/1.0/demo/scripts/jsurl.js"></script>

  <script src="../js/jquery.min.js"></script>
  <script src="../js/js.cookie-2.2.0.min.js"></script>
  <script src="../js/countUp.js"></script>

  <style>
    /************ 左侧统计 ***************/

    .stat-container {
      width: 300px;
      height: 300px;
      position: absolute;
      top: 10%;
      z-index: 1000;
      margin-left: 10px;
    }

    .stat-box {
      margin: 0 auto;
      padding: 5px 5px 5px 5px;
      max-width: 100%;
      overflow-x: visible;
      border-top: 5px solid red;
      background-color: rgba(56, 48, 48, 0.6);
      margin-bottom: 10px;
      position: relative;
      height: 45px;
    }

    .stat-box .stat-box-icon {
      margin-left: 5px;
      margin-top: 11px;
      position: absolute;
    }

    .stat-box .stat-box-icon i {
      font-size: 20px;
      color: yellow;
    }

    .stat-box .stat-info {
      width: 150px;
      font-size: 20px;
      color: #FFFFFF;
      margin-left: 32px;
      margin-top: 8px;
    }

    .stat-box .stat-num {
      width: 80px;
      color: #FFFFFF;
      font-size: 32px;
      text-align: right;
      margin-right: 15px;
    }



    .pull-right {
      float: right !important;
    }

    .pull-left {
      float: left !important;
    }

    @font-face {
      font-family: 'iconfont';
      src: url('../icon/iconfont.eot');
      src: url('../icon/iconfont.eot?#iefix') format('embedded-opentype'),
      url('../icon/iconfont.woff') format('woff'),
      url('../icon/iconfont.ttf') format('truetype'),
      url('../icon/iconfont.svg#iconfont') format('svg');
    }

    .iconfont {
      font-family: "iconfont" !important;
      font-size: 16px;
      font-style: normal;
      -webkit-font-smoothing: antialiased;
      -webkit-text-stroke-width: 0.2px;
      -moz-osx-font-smoothing: grayscale;
    }
    /************ 地图操作 ***************/

    .operator-container {
      position: absolute;
      bottom: 20px;
      width: 98%;
      text-align: center;
      z-index: 1000;
    }

    .operator-container .operator-ops {
      width: 880px;
      border-top: 5px solid #0CD6D3;
      margin: 0 auto;
      padding-left: 10px;
      background-color: rgba(56, 48, 48, 0.6);
      color: #FFFFFF;
      height: 54px;
    }

    .operator-container .operator-label {
      margin: 15px 20px 0 0;
      display: inline-block
    }

    .operator-container .operator-radio {
      display: none
    }

    .operator-container .operator-input {
      background-color: #fff;
      border: 1px solid rgba(0, 0, 0, 0.15);
      border-radius: 100%;
      display: inline-block;
      height: 16px;
      margin-right: 10px;
      margin-top: -1px;
      vertical-align: middle;
      width: 16px;
      line-height: 1;
    }

    .operator-container .operator-radio:checked+.operator-input:after {
      background-color: #409eff;
      border-radius: 100%;
      content: "";
      display: inline-block;
      height: 12px;
      margin: 2px;
      width: 12px
    }

    .operator-container .operator-checkbox.operator-input,
    .operator-radio:checked+.operator-checkbox.operator-input:after {
      border-radius: 0
    }
    /************ 右侧菜菜单 ***************/

    .detail-container {
      width: 300px;
      position: absolute;
      top: 10%;
      right: 10px;
      z-index: 1000;
      margin-left: 10px;
    }


    .detail-tab-container {
      width: 300px;
      margin: 0px;
      padding: 0px;
      margin-bottom: 15px;
      overflow: hidden;
    }

    .detail-tab-border {
      /* border:1px solid #95C9E1;*/
    }

    .detail-menu-box {
      line-height: 28px;
      position: relative;
      float: left;
      width: 44px;
      height: 400px;
      /* border-right:1px solid #95C9E1; */
    }

    .detail-menu-box ul {
      margin: 0px;
      padding: 0px;
      list-style: none;
      position: absolute;
      /* top:15px; */
      left: 5px;
      margin-left: 10px;
      height: 25px;
      text-align: center;
    }

    .detail-menu-box li {
      display: block;
      cursor: pointer;
      width: 28px;
      color: #FFFFFF;
      font-weight: bold;
      margin-bottom: 5px;
      height: 62px;
      line-height: 25px;
      padding-top: 6px;
      background-color:rgba(56,48,48,0.6);
      border-top-left-radius: 10px 10px;
      writing-mode: vertical-lr;
      letter-spacing: 5px;
    }

    .detail-menu-box li.hover {
      background: #FB4072;
      width: 28px;
      border-right: 0;
      color: #FFFFFF;
      height: 62px;
      line-height: 25px;
    }

    .detail-content-box {
      margin-top: 0px;
      border-top: none;
      padding: 3px 5px 3px 5px;
      border-left: 0;
      margin-left: 43px;
      background-color: rgba(56, 48, 48, 0.6);
      height: 400px;
    }

    /************ 右侧菜菜单 - 子菜单 ***************/
    .detail-sub-container {
      border-top: 3px solid rgb(190, 18, 18);
      width: 246px;
    }

    .detail-sub-container .detail-sub-menu-box {
      height: 28px;
      line-height: 28px;
      position: relative;
      border-bottom: 1px solid rgb(63, 70, 73);
    }

    .detail-sub-container ul {
      margin: 0px;
      padding: 0px;
      list-style: none;
      position: absolute;
      top: 4px;
      left: 0;
      height: 25px;
      text-align: center;
    }

    .detail-sub-container li {
      float: left;
      display: block;
      cursor: pointer;
      width: 60px;
      color: #FFFFFF;
      font-weight: bold;
      margin-right: 2px;
      height: 25px;
      line-height: 25px;
      background-color: rgb(190, 18, 18, 0);
      font-size: 14px;
    }

    .detail-sub-container li.hover {
      background-color: rgb(190, 18, 18);
    }

    .detail-sub-container .detail-sub-content-box {
      padding-top: 8px;
      height: 350px;
      overflow-y: auto;
    }

    .detail-sub-container .detail-sub-content-box::-webkit-scrollbar {
      width: 6px;
      height: 2px;
    }
    .detail-sub-container .detail-sub-content-box::-webkit-scrollbar-thumb {
      border-radius: 1px;
      background: #535353;
    }
    .detail-sub-container .detail-sub-content-box::-webkit-scrollbar-track {
      border-radius: 1px;
      background: #EDEDED;
    }

    /************ 右侧菜菜单 - 子菜单 - 人脸 - 抓拍 ***************/
    .con_subdetail_face_1_item {
      display: block;
      height: 90px;
    }

    .con_subdetail_face_1_item .item_avatar {
      width:80px;
      height:80px;
      display: block;
      float: left;
    }

    .con_subdetail_face_1_item .item_avatar img {
      width:80px;
      height:80px;
    }

    .con_subdetail_face_1_item .item_info {
      display: block;
      float: left;
      margin-left: 5px;
      color: #FFFFFF;
      font-size: 14px;
      line-height: 1.5rem;
    }

    /************ 右侧菜菜单 - 子菜单 - 人脸 - 比中 ***************/
    .con_subdetail_face_2_item {
      display: block;

    }

    .con_subdetail_face_2_item .item-title {
      line-height: 25px;
      height: 25px;
    }

    .con_subdetail_face_2_item .item-title {
      line-height: 25px;
      height: 25px;
      font-size: 14px;
      color: #FFFFFF;
    }

    .con_subdetail_face_2_item .item-title i {
      float:left;
      color:#0075c2;
    }

    .con_subdetail_face_2_item .item-title .item-title-name {
      float:left;
      margin-left: 5px;
    }

    .con_subdetail_face_2_item .item-title .item-title-time {
      float: right;
      color:#cecbcb;
    }

    .con_subdetail_face_2_item .item-content {
      display: block;
      height: 75px;
      margin-bottom: 5px;
    }

    .con_subdetail_face_2_item .item_avatar {
      width:70px;
      height:70px;
      display: block;
      float: left;
      margin-right: 8px;
    }

    .con_subdetail_face_2_item .item_avatar img {
      width:70px;
      height:70px;
    }

    .con_subdetail_face_2_item .item_info {
      display: block;
      float: left;
      color: #FFFFFF;
      font-size: 14px;
      line-height: 1.5rem
    }

    .con_subdetail_face_2_item .item_info .item_info_contrast {
      color: gold;
      font-size: 24px;
      margin-bottom: 2px;
    }


    /******* 地图颜色覆盖 **********/
    .imap-popup-content-wrapper,
    .imap-popup-tip {
      background: rgba(20, 65, 170, 0.7);
      box-shadow: 3px 4px 9px 2px #0075c2;
    }

    .imap-window {
      background-color: transparent;
      color:#FFFFFF;
    }

    .infowindow-container {
			width: 280px;
		}

		.infowindow-container .infowindow-title {
			position: relative;
      background-color: rgba(20, 65, 170, 0.7);
			border-bottom: 1px solid #CCC;
			border-radius: 5px 5px 0 0;
		}

		.infowindow-container .infowindow-title-content {
			display: inline-block;
      color: #FFFFFF;
			font-size: 14px;
			font-weight: bold;
			line-height: 31px;
			padding: 0 10px;
		}

		.infowindow-container .infowindow-title-close {
			position: absolute;
			top: 5px;
			right: 10px;
			transition-duration: 0.25s;
      color: #FFFFFF;
		}

		.infowindow-container .infowindow-content {
			font-size: 12px;
			padding: 6px;
			line-height: 20px;
			background-color: rgba(20, 65, 170, 0.7);
			height:67px;
      color: #FFFFFF;
		}

		.infowindow-container .infowindow-content-image {
			float: left;
			margin-right: 10px;
			width: 100px;
			height: 60px;
		}

		.infowindow-container .infowindow-marker {
			height: 0px;
			width: 100%;
			clear: both;
			text-align: center;
			position: relative;
			top: -17px;
			margin: 0px auto;
		}

    .infowindow-container .infowindow-marker i {
        font-size: 32px;
        color: rgba(20, 65, 170, 0.7);
    }
  </style>

  <script>

    $(document).ready(function () {

      // 页面初始数据
      initData();

      // 地图展示数据类型切换
      $(".operator-radio").click(function () {

        var name = $(this).attr("name");
        var checked = $(this).is(":checked");

        // 选中实有房屋
        if (name == 'operator-house' && checked) {
          showHouseLocations();
        }

        // 取消选中实有房屋
        if (name == 'operator-house' && !checked) {
          hiddenHouseLocations();
        }

        // 选中实有单位
        if (name == 'operator-dwxx' && checked) {
          showLocationsByType("dwxx");
        }

        // 取消选中实有单位
        if (name == 'operator-dwxx' && !checked) {
          hiddenLocationsByType("dwxx");
        }

        // 选中小区出入口
        if (name == 'operator-xqxx' && checked) {
          showLocationsByType("xqxx");
        }

        // 取消选中小区出入口
        if (name == 'operator-xqxx' && !checked) {
          hiddenLocationsByType("xqxx");
        }

        // 选中实有安防设施
        if (name == 'operator-camera' && checked) {
          showLocationsByType("camera");
        }

        // 取消实有安防设施
        if (name == 'operator-camera' && !checked) {
          hiddenLocationsByType("camera");
        }

      });
    });

    // 页面初始化需要加载的数据
    function initData() {
      var token = Cookies.get("Admin-Token");

      createEventSource(successCallBack);

      // 加载一标六实数据
      setInterval(loadData("http://localhost:8081/api/houses/amounts", token, function (data) {
        var code = data.code;
        if (code == 200) {
          var ybls = data.data;
          countUp('syrk', ybls.syrk);
          countUp('syfw', ybls.syfw);
          countUp('sydw', ybls.sydw);
          countUp('syafss', ybls.syafss);
          countUp('syllzb', ybls.syllzb);
          countUp('syjq', ybls.syjq);
        }
      }), 1000 * 30)

      // 页面默认的定位信息数据加载
      loadDefaultLocations();
    }


    function successCallBack(e){
        var data = JSON.parse(e.data);
          var code = data.code;
          if (code == 200&&data.dataType=='YBLS') {
            var ybls = data.data;
            countUp('syrk', ybls.syrk);
            countUp('syfw', ybls.syfw);
            countUp('sydw', ybls.sydw);
            countUp('syafss', ybls.syafss);
            countUp('syllzb', ybls.syllzb);
            countUp('syjq', ybls.syjq);
          }
      }

    function createEventSource(successCallBack){
      var token = Cookies.get("Admin-Token");
      var url = 'http://localhost:8081/api/sseEmitter/ybls?Authorization=' + token;
      if (!!window.EventSource) {
        var source = new EventSource(url);
        source.addEventListener('message', function (e) {
          successCallBack(e);
        }, true);
        source.addEventListener('open', function (e) {
          console.log("Connection opened");
        }, true);

        source.addEventListener('error', function (e) {
          console.log("Connection error");
        }, true);

        source.addEventListener('close', function (e) {
          console.log("Connection closed");
        }, true);


      }

      // 页面默认的定位信息数据加载
      loadDefaultLocations();

      // 右侧菜单数据加载
      loadDefaultMenuDatas();

    }

    // 右侧菜单数据加载
    function loadDefaultMenuDatas (){

      // 右侧菜单人脸识别数据 - 抓拍
      loadFaceMsgData();

      // 右侧菜单人脸识别数据 - 比中
      loadFaceSimilarData();

    }

    // 加载抓拍数据 - 抓拍
    function loadFaceSimilarData(){

      var token = Cookies.get("Admin-Token");

      // 右侧菜单人脸识别数据 - 比中
      loadData("http://localhost:8081/api/face/similar", token, function (data) {
        var code = data.code;
        if (code == 200) {
          var messages = data.data;
          showMenuContentForFaceSimilar(messages);
        }
      });
    }

    // 人脸数据(比中)内容展示
    function showMenuContentForFaceSimilar(messages){

      var token = Cookies.get("Admin-Token");

      var faceSimilarHtml = "";
      for(var i = 0; i< messages.length; i++) {

        var carameName = messages[i].cameraName;
        if (carameName.substring(0, 4) == '万盛金邸') {
          carameName = carameName.substring(4);
        }

        faceSimilarHtml = faceSimilarHtml + "<div class=\"con_subdetail_face_2_item\">";
        faceSimilarHtml = faceSimilarHtml + " <div class=\"item-title\">";
        faceSimilarHtml = faceSimilarHtml + "   <i class=\"iconfont\">&#xe651;</i>";
        faceSimilarHtml = faceSimilarHtml + "   <div class=\"item-title-name\">" + carameName + "</div>";
        faceSimilarHtml = faceSimilarHtml + "   <div class=\"item-title-time\">"+ messages[i].timeBegin +"</div>";
        faceSimilarHtml = faceSimilarHtml + " </div>";
        faceSimilarHtml = faceSimilarHtml + " <div class=\"item-content\">";
        faceSimilarHtml = faceSimilarHtml + "   <div class=\"item_avatar\">";
        faceSimilarHtml = faceSimilarHtml + "     <img src=\"http://116.228.125.236:18181/" + messages[i].faceImageUrl + ".jpg\"></img>";
        faceSimilarHtml = faceSimilarHtml + "   </div>";
        faceSimilarHtml = faceSimilarHtml + "   <div class=\"item_avatar\">";
        faceSimilarHtml = faceSimilarHtml + "     <img src=\"http://localhost:8081/api/face/similar/" + messages[i].hitZjhm + "/zp?Authorization=" + token +"\"></img>";
        faceSimilarHtml = faceSimilarHtml + "   </div>";
        faceSimilarHtml = faceSimilarHtml + "   <div class=\"item_info\">";
        faceSimilarHtml = faceSimilarHtml + "     <div class=\"item_info_contrast\">" + messages[i].similarity + "</div>";
        faceSimilarHtml = faceSimilarHtml + "     <div>" + messages[i].hitXm + "</div>";
        faceSimilarHtml = faceSimilarHtml + "     <div title=\""+ messages[i].hitZjhm +"\"><img src=\"/static/image/sfz.jpg\" width=\"20\" /></div>";
        faceSimilarHtml = faceSimilarHtml + "   </div>";
        faceSimilarHtml = faceSimilarHtml + "  </div>";
        faceSimilarHtml = faceSimilarHtml + "</div>";
      }

      $("#con_subdetail_face_2").html(faceSimilarHtml);
    }

    // 加载人脸数据 - 比中
    function loadFaceMsgData(){

      var token = Cookies.get("Admin-Token");

      // 右侧菜单人脸识别数据 - 抓拍
      loadData("http://localhost:8081/api/face/msg", token, function (data) {
        var code = data.code;
        if (code == 200) {
          var messages = data.data;
          showMenuContentForFaceMsg(messages);
        }
      });
    }

    // 人脸数据(抓拍)内容展示
    function showMenuContentForFaceMsg(messages) {

      var faceMsgHtml = "";
      for(var i = 0; i< messages.length; i++) {

        faceMsgHtml = faceMsgHtml + "<div class=\"con_subdetail_face_1_item\">";
        faceMsgHtml = faceMsgHtml + " <div class=\"item_avatar\">";
        faceMsgHtml = faceMsgHtml + "   <img src=\"http://116.228.125.236:18181/" + messages[i].faceImageUrl + ".jpg\" onerror=\"this.src='/static/image/default_nophoto.png'\"></img>";
        faceMsgHtml = faceMsgHtml + " </div>";
        faceMsgHtml = faceMsgHtml + " <div class=\"item_info\">";
        faceMsgHtml = faceMsgHtml + "   <div>" + messages[i].cameraName + "</div>";
        faceMsgHtml = faceMsgHtml + "   <div>" + messages[i].timeBegin + "</div>";
        faceMsgHtml = faceMsgHtml + " </div>";
        faceMsgHtml = faceMsgHtml + "</div>";

      }

      $("#con_subdetail_face_1").html(faceMsgHtml);
    }



    // 页面默认的定位
    function loadDefaultLocations() {

      // 加载实有房屋
      loadHouseLocations();

      // 加载实有单位
      loadDwLocations();

      // 加载小区出入口
      loadXqxxLocations();

      // 加载安防措施
      loadCameraLocations();

    }

    // 加载安防措施定位
    function loadCameraLocations(){
      var token = Cookies.get("Admin-Token");
      loadData("http://localhost:8081/api/camera/locations", token, function(data){
        var code = data.code;
        if (code == 200) {
          var locations = data.data;
          for (var i = 0; i < locations.length; i++) {
            if (locations[i].lng != "" && locations[i].lat != "") {
              addMarker(locations[i].lng, locations[i].lat, locations[i].xh, "camera", locations[i]);
            }
          }
        }
      });
    }

    // 加载小区出入口定位
    function loadXqxxLocations(){
      var token = Cookies.get("Admin-Token");
      loadData("http://localhost:8081/api/xqxx/locations", token, function(data){
        var code = data.code;
        if (code == 200) {
          var locations = data.data;
          for (var i = 0; i < locations.length; i++) {
            if (locations[i].lon != "" && locations[i].lat != "") {
              addMarker(locations[i].lon, locations[i].lat, locations[i].crkbh, "xqxx", locations[i]);
            }
          }
        }
      });
    }

    // 加载实有单位
    function loadDwLocations() {
      var token = Cookies.get("Admin-Token");
      loadData("http://localhost:8081/api/dwxx/locations", token, function (data) {
        var code = data.code;
        if (code == 200) {
          var locations = data.data;
          for (var i = 0; i < locations.length; i++) {
            if (locations[i].gpsLat != "" && locations[i].gpslon != "") {
              addMarker(locations[i].gpsLon, locations[i].gpsLat, locations[i].dwbh, "dwxx", locations[i]);
            }
          }
        }
      });
    }

    // 加载实有房屋
    function loadHouseLocations() {
      var token = Cookies.get("Admin-Token");
      loadData("http://localhost:8081/api/houses/locations", token, function (data) {
        var code = data.code;
        if (code == 200) {
          var locations = data.data;
          for (var i = 0; i < locations.length; i++) {
            addMarker(locations[i].gpsjd, locations[i].gpswd, locations[i].cjbh, "house", locations[i]);
          }
        }
      });
    }

    // 展示某个类型的坐标信息
    function showLocationsByType(type){
      var overlays = map.getOverlayLayer().getOverlays();
      for(var i in overlays){
        if (overlays[i].type == type) {
          overlays[i].visible(true);
        }
      }
    }

    // 隐藏某个类型的坐标信息
    function hiddenLocationsByType(type){
      var overlays = map.getOverlayLayer().getOverlays();
      for(var i in overlays){
        if (overlays[i].type == type) {
          overlays[i].visible(false);
        }
      }
    }

    // 展示实有房屋位置
    function showHouseLocations() {
      var overlays = map.getOverlayLayer().getOverlays();
      for (var i in overlays) {
        if (overlays[i].type == "house") {
          overlays[i].visible(true);
        }
      }
    }

    // 隐藏实有房屋位置
    function hiddenHouseLocations() {
      var overlays = map.getOverlayLayer().getOverlays();
      for (var i in overlays) {
        if (overlays[i].type == "house") {
          overlays[i].visible(false);
        }
      }
    }

    // 异步加载数据
    function loadData(url, token, callback) {
      $.ajax({
        headers: {
          Authorization: token
        },
        type: "get",
        url: url,
        success: function (data) {
          callback(data);
        }
      });
    }

    // 右侧菜单切换
    function setTab(name, cursel, n) {
      for (i = 1; i <= n; i++) {
        var menu = document.getElementById(name + i);
        var con = document.getElementById("con_" + name + "_" + i);
        menu.className = i == cursel ? "hover" : "";
        con.style.display = i == cursel ? "block" : "none";
      }
    }

    // 子菜单切换
    function setSubTab(prefix, model, index) {

      console.info("setSubTab:" + prefix + ":" + model + ":" + index );

      // 菜单展示效果
      $("." + prefix + "_" + model).removeClass("hover");
      $("#" + prefix + "_" + model + "_" + index).addClass("hover");

      // 菜单对应内容切换
      $(".con_" + prefix + "_" + model).css('display','none');
      $("#con_" + prefix + "_" + model + "_" + index).css('display','block');
    }

    // 添加点标注
    function addMarker(lng, lat, did, type, origin) {

      var path = locationPath();
      if (map) {
        var opts = new IMAP.MarkerOptions();
        opts.anchor = IMAP.Constants.BOTTOM_CENTER;
        opts.icon = new IMAP.Icon(
          path + "/static/image/" + type + "_16.png", {
            "size": new IMAP.Size(16, 16),
            "offset": new IMAP.Pixel(0, 0)
          }
        );

        var lnglat = new IMAP.LngLat(lng, lat);
        marker = new IMAP.Marker(lnglat, opts);
        marker.id = type + "_" + did;
        marker.type = type;
        map.getOverlayLayer().addOverlay(marker, false);


        // 图标上添加点击事件
        addMarkerClickEvt(type, origin, marker);
      }
    }

    var _current_marker;
    function addMarkerClickEvt(type, origin, marker) {

      // 针对不同数据类型添加不同的 InfoWindow
      var content = "";
      var token = Cookies.get("Admin-Token");
      if (type == "house") {
        content = assembleInfoWindowContent("实有房屋", "http://localhost:8081/api/houses/" + origin.cjbh +"/photo?Authorization=" +token, "地址：" + origin.mlph);
      } else if (type == "dwxx") {
        content = assembleInfoWindowContent("实有单位", "http://localhost:8081/api/dwxx/" + origin.dwbh + "/photo?Authorization=" +token ,"名称：" + origin.dwmc);
      } else if (type == 'xqxx') {
        content = assembleInfoWindowContent("小区出入口", "http://localhost:8081/api/xqxx/" + origin.crkbh + "/photo?Authorization=" +token ,"名称：" + origin.crkmc);
      } else if (type == 'camera') {
        content = assembleInfoWindowContent("实有安防设施", "http://localhost:8081/api/camera/" + origin.xh + "/photo?Authorization=" +token ,"名称：" + origin.name);
      }

      // 图标点击事件
      if (content != "") {
        marker.addEventListener(IMAP.Constants.CLICK, function(evt) {

          // 如果其他 Marker 打开了消息框，则关闭
          if (_current_marker) {
            _current_marker.closeInfoWindow();
          }

          // 打开消息框
          _current_marker = this;
          var lnglat = this.getPosition();
          this.openInfoWindow (
            content,
            {
              size : new IMAP.Size(320, 110),
              position: lnglat,
              autoPan : false,
              offset : new IMAP.Pixel(160, 75),
              anchor:IMAP.Constants.CENTER,
              type:IMAP.Constants.OVERLAY_INFOWINDOW_CUSTOM,
              visible: true
            }
          );
        });
      }
    }

    function assembleInfoWindowContent (title, url, context) {
      var content ="<div class=\"infowindow-container\">"
      content = content + "<div class=\"infowindow-title\">"
      content = content + "<div class=\"infowindow-title-content\">";
      content = content + title;
      content = content + "</div>";
      content = content + "<span class=\"infowindow-title-close\" onclick=\"closeInfoWindow()\">";
      content = content + "<i class=\"iconfont\">&#xe603;</i>"
      content = content + "</span>";
      content = content + "</div>";
      content = content + "<div class=\"infowindow-content\">";
      content = content + "<img class=\"infowindow-content-image\" src=\" " + url + "\"/>";
      content = content + context;
      content = content + "</div>";
      content = content + "<div class=\"infowindow-marker\">";
      content = content + "<i class=\"iconfont\">&#xe682;</i>";
      content = content + "</div>";
      content = content + "</div>";
      return content;
    }

    // 关闭消息窗
    function closeInfoWindow(){
      if (map && _current_marker) {
        _current_marker.closeInfoWindow();
      }
    }

    // 展示详情
    function showInfoWindow(type, origin) {
      if (type == 'house') {
        showHouseInfoWindow(origin);
      }
    }

    // 展示房屋详情
    function showHouseInfoWindow(origin) {
      console.info(origin);
    }

    function locationPath() {
      var href = window.document.location.href;
      var pname = window.document.location.pathname;
      var pos = href.indexOf(pname);
      var path = href.substring(0, pos);
      return path;
    }

    //动态显示数据
    function countUp(id, end) {
      var oldCntStr = document.getElementById(id).innerText;
      var oldCnt = oldCntStr.replace(/[,]/g, "");
      var options = {
        useEasing: true,
        useGrouping: true,
        separator: ',',
        decimal: '.',
      };
      var obj = new CountUp(id, oldCnt, end, 0, 2.5, options);
      obj.start();
    }

    //打开一标六实详细信息页面
    function openYblsDetail() {
      window.open("http://localhost:8080/#/ybls");
    }
  </script>
</head>

<body>
  <div id="map" class="map_contaner"></div>
  <!-- 一标六尺 -->
  <div class="stat-container">
    <div class="stat-box">
      <span class="stat-box-icon pull-left">
        <i class="iconfont">&#xe66e;</i>
      </span>
      <div class="stat-info pull-left">
        实有人口
      </div>
      <a href="javascript:;" onclick="openYblsDetail('syrk');">
        <div class="stat-num pull-right" id="syrk">0</div>
      </a>
    </div>

    <div class="stat-box">
      <span class="stat-box-icon pull-left">
        <i class="iconfont">&#xe600;</i>
      </span>
      <div class="stat-info pull-left">实有房屋</div>
      <a href="javascript:;" onclick="openYblsDetail('syfw');">
        <div class="stat-num pull-right" id="syfw">0</div>
      </a>
    </div>

    <div class="stat-box">
      <span class="stat-box-icon pull-left">
        <i class="iconfont">&#xe616;</i>
      </span>
      <div class="stat-info pull-left">实有单位</div>
      <a href="javascript:;" onclick="openYblsDetail('sydw');">
        <div class="stat-num pull-right" id="sydw">0</div>
      </a>
    </div>

    <div class="stat-box">
      <span class="stat-box-icon pull-left">
        <i class="iconfont">&#xe9a7;</i>
      </span>
      <div class="stat-info pull-left">实有安防措施</div>
      <div class="stat-num pull-right" id="syafss">0</div>
    </div>

    <div class="stat-box">
      <span class="stat-box-icon pull-left">
        <i class="iconfont">&#xe63d;</i>
      </span>
      <div class="stat-info pull-left">实有力量与装备</div>
      <div class="stat-num pull-right" id="syllzb">0</div>
    </div>

    <div class="stat-box">
      <span class="stat-box-icon pull-left">
        <i class="iconfont">&#xe63e;</i>
      </span>
      <div class="stat-info pull-left">实有警情</div>
      <div class="stat-num pull-right" id="syjq">0</div>
    </div>
  </div>

<!-- 地图操作按钮 -->
<div class="operator-container">
  <div class="operator-ops">
    <label class="operator-label">
      <input class="operator-radio" type="checkbox" name="operator1" checked>
      <span class="operator-checkbox operator-input"></span>
      动态感知
    </label>
    <label class="operator-label">
      <input class="operator-radio" type="checkbox" name="operator-house" checked>
      <span class="operator-checkbox operator-input"></span>
      实有房屋
    </label>
    <label class="operator-label">
      <input class="operator-radio" type="checkbox" name="operator-dwxx" checked>
      <span class="operator-checkbox operator-input"></span>
      实有单位
    </label>
    <label class="operator-label">
      <input class="operator-radio" type="checkbox" name="operator-camera" checked>
      <span class="operator-checkbox operator-input"></span>
      实有安防设施
    </label>
    <label class="operator-label">
      <input class="operator-radio" type="checkbox" name="operator5">
      <span class="operator-checkbox operator-input"></span>
      实有力量
    </label>
    <label class="operator-label">
      <input class="operator-radio" type="checkbox" name="operator-xqxx" checked>
      <span class="operator-checkbox operator-input"></span>
      小区出入口
    </label>
    <label class="operator-label">
      <input class="operator-radio" type="checkbox" name="operator-xqxx1" checked>
      <span class="operator-checkbox operator-input"></span>
      窨井盖
    </label>
  </div>
</div>

<div class="detail-container">
  <div class="detail-tab-container detail-tab-border">
    <div class="detail-menu-box ">
      <ul>
        <li id="detail1" onclick="setTab('detail',1,5)" class="hover">
          人脸
        </li>
        <li id="detail2" onclick="setTab('detail',2,5)" >
          开门
        </li>
        <li id="detail3" onclick="setTab('detail',3,5)">
          过车
        </li>
        <li id="detail4" onclick="setTab('detail',4,5)">
          WIFI
        </li>
        <li id="detail5" onclick="setTab('detail',5,5)">
          消防
        </li>
      </ul>
    </div>
    <div class="detail-content-box">
      <!-- 人脸标签页内容 -->
      <div id="con_detail_1" >
        <div class="detail-sub-container">
          <div class="detail-sub-tab-container detail-sub-tab-border">
            <div class="detail-sub-menu-box ">
              <ul>
                <li class="subdetail_face hover" id="subdetail_face_1" onclick="setSubTab('subdetail', 'face', 1)">
                  抓拍
                </li>
                <li class="subdetail_face" id="subdetail_face_2" onclick="setSubTab('subdetail', 'face', 2)">
                  比中
                </li>
              </ul>
            </div>
            <div class="detail-sub-content-box">
              <div class="con_subdetail_face" id="con_subdetail_face_1">
              </div>
              <div class="con_subdetail_face" id="con_subdetail_face_2" style="display:none">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="con_detail_2" style="display:none">
        开门
      </div>
      <div id="con_detail_3" style="display:none">
        过车
      </div>
      <div id="con_detail_4" style="display:none">
        WIFI
      </div>
      <div id="con_detail_5" style="display:none">
        消防
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  var map;
  function initMap(){
    map=new IMAP.Map("map", {
      minZoom: 3,
      maxZoom: 20,
      // 设置地图初始化级别
      zoom : 17,
      // 设置地图中心点坐标
      center : new IMAP.LngLat(121.3377285004, 30.7521905824),
      // 设置地图缩放动画效果
      animation : true
    });
  }

    // 初始化地图
    initMap();
    // 添加路网图层
    addRoadNetLayer();

  </script>
</body>
</html>
